@model Mashi.Models.UserLoginModel

@{
    ViewBag.Title = "Home Page";
    Layout = null;
  
}
<!DOCTYPE html>
<html lang="en">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Proanto</title>

    <!-- Bootstrap -->
    <link href="~/css/bootstrap.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="~/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <!-- Custom Theme Style -->
    <link href="~/css/track-smart.css" rel="stylesheet">
    <script src="/js/jquery.js"></script>
    <script src="~/js/bootstrap.js"></script>
    <link href="~/Content/Timer/css/example.css" rel="stylesheet" />
    <link href="~/Content/Timer/css/jquery.countdown.timer.css" rel="stylesheet" />
    <script src="~/Content/Timer/js/jquery.countdown.counter.js"></script>
    <script src="~/Content/Timer/js/jquery.timeout.interval.idle.js"></script>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
		<script src="js/html5shiv.min.js"></script>
		<script src="js/respond.min.js"></script>
    <![endif]-->

    <style>
        #centered_div {
            margin: 0px !important;
        }

        #counter {
            margin-top: 0px !important;
        }
    </style>

</head>

<body class="login">
    <!--wrapper starts-->
    @using (Html.BeginForm(new { ReturnUrl = ViewBag.ReturnUrl }))
    {
        @Html.AntiForgeryToken()
        <div class="wrapper text-center">
            <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 col-lg-offset-4 col-md-offset-4">
                <!--logo starts-->
                <div class="logo">
                    <a href="#">
                        <img src="/images/logo.png" alt="Yoma Track Smart"></a>
                </div>
                <!--logo closed-->
                <!--login form starts-->
                <div class="login-form">
                    <h1>SIGN IN</h1>
                    <form action="">
                        <div class="form-group">
                            <input type="text" class="form-control" name="UserName" id="user_name" placeholder="User Name">
                            @* @Html.TextBoxFor(m => m.UserName, new { @class = "text" })*@
                            @Html.ValidationMessageFor(m => m.UserName)
                        </div>
                        <div class="form-group">
                            <input type="password" name="Password" class="form-control" id="password" placeholder="Password">
                            @Html.ValidationMessageFor(m => m.Password)
                            @Html.ValidationSummary(true)
                        </div>
                        <div class="row">

                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-left">
                                <div class="checkbox">
                                    <label>
                                        @Html.CheckBoxFor(m => m.StayLogin) Remember me
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-right">

                                <button type="submit" class="btn btn-default orange_btn">SIGN IN</button>
                            </div>
                        </div>
                        <!--Add by Ritesh Kumar Forgot Password-->
                        <div class="row">

                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 text-left">

                                <label>
                                    <a id="ModelShow" style="color: white; cursor:pointer">Forgot password</a>
                                    @*  <button id='ModelShow' type='button' class='bg-orange btn remove-border-radius'>Forgot Password</button>*@
                                </label>

                            </div>

                        </div>
                        <!--End-->
                        <div class="clearfix"></div>
                        @*	<div class="forgot_link"><a href="#" class="color_orange">Forgot Password?</a></div>*@
                    </form>
                </div>
                <!--login form closed-->
                <!--login footer starts-->
                <div class="login-footer">
                    <p>Powered by : YOMA Technologies Pvt. Ltd.</p>
                </div>
                <span id="siteseal">
                    <script async type="text/javascript" src="https://seal.godaddy.com/getSeal?sealID=UGGH73jMoIEMEahccNMwmPRGbgPmN1xQjuQWLy5uk1In1kc7zk4AvLtz2u8I"></script>
                </span>
                <!--login footer closed-->
            </div>
        </div>
        <!--Model Popup-->
            
        <!--Modal For Reject -->


            
    }
    <!--wrapper closed-->
    <!--Modal Pop Up -->

    <div class="modal fade bs-example-modal-md" tabindex="-1" role="dialog" id="ModelDiv" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-md" role="document" style="overflow: auto; max-height: 85%; margin-top: 50px; margin-bottom: 50px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="ClosePopup();"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="gridSystemModalLabel" style="color: black">Forgot Password</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="hdnUserId" />

                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="form-group">
                                <label for="UserId" style="color: black">User Login</label>
                                @Html.TextBox("txtUserId", null, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="form-group">
                                <label for="UserId" style="color: black">Registered Mobile No.</label>
                                @Html.TextBox("txtMobileNo", null, new { @class = "form-control" })
                            </div>
                        </div>

                    </div>
                    <div class="row">

                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="form-group">
                                <label for="lblNewPassword" style="color: black">New Password.</label>
                                @Html.TextBox("txtNewPass", null, new { @class = "form-control", type = "password" })
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <div class="form-group">
                                <label for="lblConfirmPass" style="color: black">Confirm Password.</label>
                                @Html.TextBox("txtConfirmPass", null, new { @class = "form-control", type = "password" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group">
                                <button id='BtnCheckUserId' type='button' class='bg-orange btn remove-border-radius'>Next</button>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center" id="TimerDiv" style="display:none;">
                            <div id="centered_div">
                                <div id="counter">
                                    <div id="counter_item1" class="counter_item">
                                        <div class="front"></div>
                                        <div class="digit digit0"></div>
                                    </div>
                                    <div id="counter_item2" class="counter_item">
                                        <div class="front"></div>
                                        <div class="digit digit0"></div>
                                    </div>
                                    <div id="counter_item3" class="counter_item">
                                        <div class="front"></div>
                                        <div class="digit digit_colon"></div>
                                    </div>
                                    <div id="counter_item4" class="counter_item">
                                        <div class="front"></div>
                                        <div class="digit digit0"></div>
                                    </div>
                                    <div id="counter_item5" class="counter_item">
                                        <div class="front"></div>
                                        <div class="digit digit0"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="div_ChangePassword" hidden="hidden">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                <div class="form-group">
                                    <label for="lblOtp" style="color: black">OTP</label>
                                    @Html.TextBox("txtOtp", null, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                <div class="form-group">
                                    <button id='BtnUpdatePassword' type='button' class='bg-orange btn remove-border-radius'>Change Password</button>
                                </div>

                            </div>
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12"></div>
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-12">
                            <div class="form-group">
                                <label id="divMessage" style="color: red"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
<script type="text/javascript">

    $(document).ready(function () {

    });

    $('#ModelShow').click(function () {
       

        $('#ModelDiv').modal('show');
        $('#BtnCheckUserId').text("Next");
        
       
    });

    $('#BtnCheckUserId').click(function () {
       
  
        $('#txtUserId').css("border", "");
        $('#txtMobileNo').css("border", "");
        $('#txtNewPass').css("border", "");
        $('#txtConfirmPass').css("border", "");

        var alrt = "";
        var UserCode = $('#txtUserId').val();
        var MobileNumber = $('#txtMobileNo').val();
        var NewPassword = $('#txtNewPass').val();
        var ConfirmPassword = $('#txtConfirmPass').val();
        if (UserCode.trim() == "") {
            alrt = "Please Enter User Login";
            $('#txtUserId').css("border", "1px solid red");
        }

        else if (MobileNumber.trim() == "") {
            alrt = "Please Enter Mobile Number";
            $('#txtMobileNo').css("border", "1px solid red");
        }
        else if ((MobileNumber != "") && (MobileNumber.trim().length < 10)) {
            alrt = "Mobile number can only be 10 digits." + "\n";
            $('#txtMobileNo').css("border", "1px solid red");

        }
        else if (MobileNumber.trim() != "" && (!validateNumeric(MobileNumber.trim()))) {
            alrt = "Please enter valid mobile number ." + "\n";
            $('#txtMobileNo').css("border", "1px solid red");

        }

        else if (NewPassword.trim() == "") {
            alrt = "Please Enter New Password";
            $('#txtNewPass').css("border", "1px solid red");
        }
        else if (NewPassword.length < 6) {
            alrt = "Password Should Be 6 Character";
            $('#txtNewPass').css("border", "1px solid red");
        }
        else if (ConfirmPassword.trim() == "") {
            alrt = "Please Enter Confirm Password";
            $('#txtConfirmPass').css("border", "1px solid red");
        }

        else if (NewPassword != ConfirmPassword) {
            alrt = "Password Should be same";
            $('#txtConfirmPass').css("border", "1px solid red");
        }
        if (alrt != "") {
            alert(alrt);
        }
        else {
            $("body").addClass("loading");
            alrt = "";
            $.ajax({

                url: "@Url.Action("GeneratOTP", "Home")",
                type: "POST",
                data: { "UserCode": UserCode, "MobileNumber": MobileNumber, "NewPassword": NewPassword },
                success: function (data) {
                    
                   
                    $("body").removeClass("loading");
                    $('#divMessage').html(data);

                    //if (data == "Dear user, your OTP has been sent to your registered mobile number")
                    if (data == "Dear user, OTP has been sent to your registered mobile number") {
                        $('#BtnCheckUserId').text("Re-Generate OTP")
                        $('#div_ChangePassword').show();

                        $("#TimerDiv").css("display", '');
                        
                        $("#BtnCheckUserId").css("display", 'none');
                        CounterInit();
                     
                       // $('#BtnUpdatePassword').button('hide');
          
                    }

                },

            });

        }

    });

    $("#txtMobileNo").keyup(function (e) {
    

        var max = 10;
        if ($("#txtMobileNo").val().length > max) {
            $("#txtMobileNo").val($("#txtMobileNo").val().substr(0, max));
        }
    });
    $("#txtMobileNo").keyup(function (e) {
   
        if (/\D/g.test(this.value)) {
            // Filter non-digits from input value.
            this.value = this.value.replace(/\D/g, '');
        }
    });


    $('#txtNewPass').keypress(function (e) {
   

        if (e.which === 32)
            return false;
    });
    $('#txtConfirmPass').keypress(function (e) {
        
        if (e.which === 32)
            return false;
    });


    function validateNumeric(txt) {
        
        var pattern = /^\d{10}$/;
        if (pattern.test(txt)) {
            return true;
        }
        else {
            return false;
        }
    }

    $('#BtnUpdatePassword').on("click", function () {
   
        $('#txtOtp').css("border", "");
        $('#divMessage').html("");
        var alrt = "";
        var OTP = $('#txtOtp').val();
        var IsResetPass = "";
        //var NewPassword = $('#txtNewPass').val();
        //var ConfirmPassword = $('#txtConfirmPass').val();
        if (OTP.trim() == "") {
            alrt = "Please Enter the OTP";
            $('#txtOtp').css("border", "1px solid red");
        }

        //else if (NewPassword.trim() == "") {
        //     alrt = "Please Enter the New Password";
        // }
        //else if (ConfirmPassword.trim() == "") {
        //     alrt = "Please Enter the Confirm Password";
        // }
        //else if (NewPassword != ConfirmPassword) {
        //     alrt = "Password Should be same";
        //}
        if (alrt != "") {
            alert(alrt);
        }
        else {
            alrt = "";
            $.ajax({
                url: "@Url.Action("UpdatePassword", "Home")",
                type: "POST",
                data: { "OTP": OTP, "IsResetPass": IsResetPass },
                success: function (data) {
                    
                  
                    $('#divMessage').html(data);
                    // if (data == "Your password has been changed successfully.") 
                    if (data == "Your Password has been changed successfully.")
                       
                    {
                        $('#div_ChangePassword').hide();

                        //$('#BtnCheckUserId').text("Generate OTP")
                        $('#BtnCheckUserId').text("Next")

                        Clear();
                    }

                }
            });
        }


    });
    function ClosePopup() {
        
        $('#ModelDiv').modal('hide');
        $.ajax({
            url: "@Url.Action("RemoveSession", "Home")",
           type: "POST",
           data: {},
           success: function (data) {
              
               

           }
       });
       $('#divMessage').html("");
       $('#BtnCheckUserId').text("Generate OTP")
       $('#div_ChangePassword').hide();
       Clear();

   }
    function Clear() {


       $('#txtOtp').val("");
       $('#txtNewPass').val("");
       $('#txtConfirmPass').val("");
       $('#txtUserId').val("");
       $('#txtMobileNo').val("");

   }


</script>
